<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>メニュー管理アプリ</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getDatabase, ref, onValue, push, set } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js";

        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            databaseURL: "your-database-url",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-messaging-sender-id",
            appId: "your-app-id"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        let isAdmin = false;
        const selectedItems = {};

        document.addEventListener('DOMContentLoaded', () => {
            const adminLogin = document.getElementById('adminLogin');
            const loginButton = document.getElementById('loginButton');
            const adminPassword = document.getElementById('adminPassword');
            const adminSection = document.getElementById('adminSection');
            const addMenuButton = document.getElementById('addMenuButton');
            const foodContainer = document.getElementById('foodContainer');
            const drinkContainer = document.getElementById('drinkContainer');
            const otherContainer = document.getElementById('otherContainer');
            const selectedItemsContainer = document.getElementById('selectedItems');
            const orderButton = document.getElementById('orderButton');

            loginButton.addEventListener('click', () => {
                if (adminPassword.value === 'admin123') {
                    isAdmin = true;
                    adminSection.style.display = 'block';
                    adminLogin.style.display = 'none';
                } else {
                    alert('パスワードが間違っています');
                }
            });

            addMenuButton.addEventListener('click', () => {
                const menuName = document.getElementById('menuName').value;
                const menuPrice = parseInt(document.getElementById('menuPrice').value, 10);
                const menuImage = document.getElementById('menuImage').value;
                const menuCategory = document.getElementById('menuCategory').value;
                const menuTax = parseInt(document.querySelector('input[name="menuTax"]:checked').value, 10);

                if (!menuName || isNaN(menuPrice) || !menuImage) {
                    alert('すべてのフィールドを正しく入力してください');
                    return;
                }

                const taxIncludedPrice = Math.ceil(menuPrice * (1 + menuTax / 100));
                const newMenuRef = push(ref(database, 'menus'));

                set(newMenuRef, {
                    name: menuName,
                    price: taxIncludedPrice,
                    image: menuImage,
                    category: menuCategory
                }).then(() => {
                    alert('メニューが追加されました');
                }).catch((error) => {
                    console.error('メニュー追加中にエラーが発生しました: ', error);
                });
            });

            onValue(ref(database, 'menus'), (snapshot) => {
                const menus = snapshot.val();
                foodContainer.innerHTML = '';
                drinkContainer.innerHTML = '';
                otherContainer.innerHTML = '';

                for (let id in menus) {
                    const menu = menus[id];
                    addMenuToDOM(id, menu.name, menu.price, menu.image, menu.category);
                }
            });

            function addMenuToDOM(id, name, price, image, category) {
                const container = category === 'フード' ? foodContainer
                               : category === 'ドリンク' ? drinkContainer
                               : otherContainer;

                const menuItem = document.createElement('div');
                menuItem.className = 'menu-item';

                const menuImageElement = document.createElement('img');
                menuImageElement.src = image;
                menuImageElement.alt = name;

                const menuNameElement = document.createElement('p');
                menuNameElement.textContent = name;

                const menuPriceElement = document.createElement('p');
                menuPriceElement.textContent = `¥${price}`;

                const quantityControls = document.createElement('div');
                const decreaseButton = document.createElement('button');
                decreaseButton.textContent = '-';

                const quantityDisplay = document.createElement('span');
                quantityDisplay.textContent = '0';

                const increaseButton = document.createElement('button');
                increaseButton.textContent = '+';

                quantityControls.appendChild(decreaseButton);
                quantityControls.appendChild(quantityDisplay);
                quantityControls.appendChild(increaseButton);

                menuItem.appendChild(menuImageElement);
                menuItem.appendChild(menuNameElement);
                menuItem.appendChild(menuPriceElement);
                menuItem.appendChild(quantityControls);
                container.appendChild(menuItem);

                selectedItems[id] = { name, price, count: 0 };

                decreaseButton.addEventListener('click', () => {
                    if (selectedItems[id].count > 0) {
                        selectedItems[id].count--;
                        quantityDisplay.textContent = selectedItems[id].count;
                        updateSelectedItems();
                    }
                });

                increaseButton.addEventListener('click', () => {
                    selectedItems[id].count++;
                    quantityDisplay.textContent = selectedItems[id].count;
                    updateSelectedItems();
                });

                if (isAdmin) {
                    const deleteButton = document.createElement('button');
                    deleteButton.textContent = '削除';
                    menuItem.appendChild(deleteButton);

                    deleteButton.addEventListener('click', () => {
                        const menuRef = ref(database, `menus/${id}`);
                        set(menuRef, null).then(() => {
                            container.removeChild(menuItem);
                        }).catch((error) => {
                            console.error('メニューの削除中にエラーが発生しました: ', error);
                        });
                    });
                }
            }

            function updateSelectedItems() {
                selectedItemsContainer.innerHTML = '<h3>選択されたメニュー</h3>';
                let totalPrice = 0;

                for (let key in selectedItems) {
                    if (selectedItems[key].count > 0) {
                        const item = selectedItems[key];
                        const itemElement = document.createElement('p');
                        itemElement.textContent = `${item.name} × ${item.count} - ¥${item.count * item.price}`;
                        selectedItemsContainer.appendChild(itemElement);
                        totalPrice += item.count * item.price;
                    }
                }

                if (totalPrice > 0) {
                    const totalElement = document.createElement('p');
                    totalElement.textContent = `合計: ¥${totalPrice}`;
                    selectedItemsContainer.appendChild(totalElement);
                }
            }

            orderButton.addEventListener('click', () => {
                const orderSummary = [];

                for (let key in selectedItems) {
                    if (selectedItems[key].count > 0) {
                        const item = selectedItems[key];
                        orderSummary.push(`${item.name} × ${item.count}`);
                    }
                }

                if (orderSummary.length > 0) {
                    alert(`注文が確定しました:\n${orderSummary.join('\n')}`);
                } else {
                    alert('メニューを選択してください');
                }
            });
        });
    </script>
</head>
<body>
    <div id="adminLogin">
        管理者パスワード: <input type="password" id="adminPassword">
        <button id="loginButton">ログイン</button>
    </div>
    <h1>メニュー選択</h1>
    <div class="menu-category">
        <h2>フード</h2>
        <div id="foodContainer" class="menu-container"></div>
    </div>
    <div class="menu-category">
        <h2>ドリンク</h2>
        <div id="drinkContainer" class="menu-container"></div>
    </div>
    <div class="menu-category">
        <h2>その他</h2>
        <div id="otherContainer" class="menu-container"></div>
    </div>
    <div id="selectedItems"></div>
    <button id="orderButton">注文を確定</button>
    <div id="adminSection" style="display: none;">
        <h2>メニュー追加</h2>
        <input type="text" id="menuName" placeholder="メニュー名">
        <input type="number" id="menuPrice" placeholder="価格">
        <input type="text" id="menuImage" placeholder="画像URL">
        <select id="menuCategory">
            <option value="フード">フード</option>
            <option value="ドリンク">ドリンク</option>
            <option value="その他">その他</option>
        </select>
        <div>
            <label><input type="radio" name="menuTax" value="8" checked> 8% 税込</label>
            <label><input type="radio" name="menuTax" value="10"> 10% 税込</label>
        </div>
        <button id="addMenuButton">メニューを追加</button>
    </div>
</body>
</html>
